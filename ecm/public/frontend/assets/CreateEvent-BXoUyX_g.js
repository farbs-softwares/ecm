var q=Object.defineProperty;var N=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var x=(u,i,r)=>i in u?q(u,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[i]=r,E=(u,i)=>{for(var r in i||(i={}))Q.call(i,r)&&x(u,r,i[r]);if(N)for(var r of N(i))W.call(i,r)&&x(u,r,i[r]);return u};import{r as g,a as Y,s as Z,au as ee,k as v,w as te,j as D,x as f,y as $,G as a,L as n,I as o,F as C,J as m,C as T,K as le,d as se,B as ae,ap as oe,a7 as M,a8 as d,av as ne,a2 as ie,aw as re}from"./frappe-ui-BA0w7BnF.js";import{d as V,u as de,_ as w,F as me,g as ue,X as ce}from"./index-CXG1Q5KM.js";import{_ as _e}from"./EventOutline-teyq-0fu.js";const pe={class:""},ve={class:"grid md:grid-cols-[70%,30%] h-full"},be={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-white px-3 py-2.5 sm:px-5"},ge={class:"flex items-center mt-3 md:mt-0"},fe={class:"mt-5 mb-10"},Ve={class:"container mb-5"},ye={class:"text-lg font-semibold mb-4"},Ee={class:"mb-4"},Ce={class:"mb-1.5 text-sm text-gray-700"},we={class:"mb-1.5 text-sm text-gray-700"},he={class:"mb-4"},ke={key:1,class:"mb-4"},Se={class:"text-xs text-gray-600 mb-1"},Ue={class:"flex items-center"},Ne={class:"border rounded-md p-2 mr-2"},xe={class:"flex flex-col"},De={class:"text-sm text-gray-500 mt-1"},$e={class:"mb-4"},Te={class:"text-lg font-semibold mb-4"},Me={class:"grid grid-cols-2 gap-10"},Le={class:"mb-4"},Pe={class:"text-lg font-semibold mb-4"},je={class:"grid grid-cols-2 gap-10"},Fe={class:"mb-4"},Oe={class:"text-lg font-semibold mb-4"},Be={class:"grid grid-cols-2 gap-10"},Ge={class:"mb-4"},Re={class:"text-lg font-semibold mb-4"},Ie={class:"grid grid-cols-2 gap-10"},ze={class:"flex items-center"},Ke={class:"flex items-center"},He={class:"border-l pt-5"},Qe={__name:"CreateEvent",props:{eventName:{type:String}},setup(u){const i=se("$user");g("");const r=ae(),L=g([]),c=u,l=Y({title:"",about_event:"",full_description:"",start_time:"",finish_time:"",start_date:"",finish_date:"",event_image:"",category:"",number_of_participate:"",location:"",status:"",number_of_participate:0,group:"",control_level:"",suggested_cost:0,is_price_negotiable:"",country:"",city:"",province:"",published:!1});Z(()=>{var e,t;c.eventName=="new"&&!((e=i.data)!=null&&e.is_moderator)&&!((t=i.data)!=null&&t.is_instructor)&&r.push({name:"Event"}),c.eventName!=="new"&&_.reload(),window.addEventListener("keydown",h)});const h=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(S(),e.preventDefault())};ee(()=>{window.removeEventListener("keydown",h)});const P=v({url:"frappe.client.insert",makeParams(e){var t;return{doc:E({doctype:"ECM Events",cover_image:((t=l.event_image)==null?void 0:t.file_url)||""},e)}}}),j=v({url:"frappe.client.set_value",auto:!1,makeParams(e){var t;return{doctype:"ECM Events",name:e.eventDetail,fieldname:E({cover_image:((t=l.event_image)==null?void 0:t.file_url)||""},l)}}}),_=v({url:"frappe.client.get",makeParams(e){return{doctype:"ECM Events",name:c.eventName}},auto:!1,onSuccess(e){Object.keys(e).forEach(t=>{Object.hasOwn(l,t)&&(l[t]=e[t])}),l.start_time=g(k(e.start_time)),l.finish_time=g(k(e.finish_time)),e.cover_image&&F.reload({image:e.cover_image}),R()}});function k(e){const[t,b,p]=e.split(":");return`${t.padStart(2,"0")}:${b}:${p}`}const F=v({url:"ecm.events_connect_management.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.event_image=e}}),S=()=>{_.data?j.submit({eventDetail:_.data.name},{onSuccess(){V("Success","Event updated successfully","check")},onError(e){var t;V("Error",((t=e.messages)==null?void 0:t[0])||e,"x")}}):P.submit(l,{onSuccess(e){V("Success","Event created successfully","check"),r.push({name:"CreateEvent",params:{eventName:e.name}})},onError(e){var t;V("Error",((t=e.messages)==null?void 0:t[0])||e,"x")}})};te(()=>c.eventName!=="new",e=>{e&&_.reload()});const O=e=>{let t=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(t))return"Only image file is allowed."},B=e=>{l.event_image=e},G=()=>{l.event_image=null},R=()=>{var t;let e=!1;(t=i.data)!=null&&t.is_moderator||(L.value.forEach(b=>{var p;!e&&b==((p=i.data)==null?void 0:p.name)&&(e=!0)}),e||r.push({name:"Events"}))},I=D(()=>{let e=[{label:"Events",route:{name:"Events"}}];return _.data&&e.push({label:l.title,route:{name:"EventDetail",params:{eventName:c.eventName}}}),e.push({label:c.eventName=="new"?"New Events":"Edit Events",route:{name:"CreateEvent",params:{eventName:c.eventName}}}),e}),z=D(()=>({title:"Create an Event",description:"Create or edit an eventDetail."})),K=v({url:"ecm.events_connect_management.utils.get_event_group_options",auto:!0}),H=v({url:"ecm.events_connect_management.utils.get_event_pricenegotiate_options",auto:!0}),A=v({url:"ecm.events_connect_management.utils.get_event_control_level_options",auto:!0});return de(z),(e,t)=>{var b,p,y;return f(),$("div",pe,[a("div",ve,[a("div",null,[a("header",be,[n(o(oe),{class:"h-7",items:I.value},null,8,["items"]),a("div",ge,[n(o(M),{variant:"solid",onClick:t[0]||(t[0]=s=>S()),class:"ml-2"},{default:C(()=>[a("span",null,m(e.__("Save")),1)]),_:1})])]),a("div",fe,[a("div",Ve,[a("div",ye,m(e.__("Details")),1),n(o(d),{modelValue:l.title,"onUpdate:modelValue":t[1]||(t[1]=s=>l.title=s),label:e.__("Title"),class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.about_event,"onUpdate:modelValue":t[2]||(t[2]=s=>l.about_event=s),label:e.__(" About Event"),class:"mb-4"},null,8,["modelValue","label"]),a("div",Ee,[a("div",Ce,m(e.__("Event Description")),1),n(o(ne),{content:l.full_description,onChange:t[3]||(t[3]=s=>l.full_description=s),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-gray-100 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),a("div",we,m(e.__("Event Cover image")),1),l.event_image?(f(),$("div",ke,[a("div",Se,m(e.__("Event Cover image")),1),a("div",Ue,[a("div",Ne,[n(o(me),{class:"h-5 w-5 stroke-1.5 text-gray-700"})]),a("div",xe,[a("span",null,m(l.event_image.file_name),1),a("span",De,m(o(ue)(l.event_image.file_size)),1)]),n(o(ce),{onClick:t[5]||(t[5]=s=>G()),class:"bg-gray-200 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(f(),T(o(re),{key:0,fileTypes:["image/*"],validateFile:O,onSuccess:t[4]||(t[4]=s=>B(s))},{default:C(({file:s,progress:J,uploading:U,openFileSelector:X})=>[a("div",he,[n(o(M),{onClick:X,loading:U},{default:C(()=>[ie(m(U?`Uploading ${J}%`:"Upload an image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),a("div",$e,[a("div",Te,m(e.__("Date and Time & Location")),1),a("div",Me,[n(o(d),{modelValue:l.start_date,"onUpdate:modelValue":t[6]||(t[6]=s=>l.start_date=s),label:e.__("Start Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.start_time,"onUpdate:modelValue":t[7]||(t[7]=s=>l.start_time=s),label:e.__("Start Time"),type:"time",class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.finish_date,"onUpdate:modelValue":t[8]||(t[8]=s=>l.finish_date=s),label:e.__("End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.finish_time,"onUpdate:modelValue":t[9]||(t[9]=s=>l.finish_time=s),label:e.__("End Time"),type:"time",class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.location,"onUpdate:modelValue":t[10]||(t[10]=s=>l.location=s),label:e.__(" Event Location"),class:"mb-4"},null,8,["modelValue","label"]),n(w,{doctype:"Country",modelValue:l.country,"onUpdate:modelValue":t[11]||(t[11]=s=>l.country=s),label:e.__("Country")},null,8,["modelValue","label"]),n(o(d),{modelValue:l.province,"onUpdate:modelValue":t[12]||(t[12]=s=>l.province=s),label:e.__(" State/Provice"),class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.city,"onUpdate:modelValue":t[13]||(t[13]=s=>l.city=s),label:e.__(" City"),class:"mb-4"},null,8,["modelValue","label"])])]),a("div",Le,[a("div",Pe,m(e.__("Price")),1),a("div",je,[n(o(d),{modelValue:l.suggested_cost,"onUpdate:modelValue":t[14]||(t[14]=s=>l.suggested_cost=s),label:e.__(" Cost"),class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.is_price_negotiable,"onUpdate:modelValue":t[15]||(t[15]=s=>l.is_price_negotiable=s),label:e.__(" Is price negotiable"),type:"select",options:(b=o(H).data)==null?void 0:b.is_price_negotiable,class:"mb-4"},null,8,["modelValue","label","options"])])]),a("div",Fe,[a("div",Oe,m(e.__("More details")),1),a("div",Be,[n(o(d),{modelValue:l.number_of_participate,"onUpdate:modelValue":t[16]||(t[16]=s=>l.number_of_participate=s),label:e.__(" Number of Participate"),class:"mb-4"},null,8,["modelValue","label"]),n(o(d),{modelValue:l.group,"onUpdate:modelValue":t[17]||(t[17]=s=>l.group=s),label:e.__("Group?"),type:"select",options:(p=o(K).data)==null?void 0:p.group,class:"mb-4"},null,8,["modelValue","label","options"]),n(o(d),{modelValue:l.control_level,"onUpdate:modelValue":t[18]||(t[18]=s=>l.control_level=s),label:e.__("Control Level"),type:"select",options:(y=o(A).data)==null?void 0:y.control_level,class:"mb-4"},null,8,["modelValue","label","options"])])]),a("div",Ge,[a("div",Re,m(e.__("Settings")),1),a("div",Ie,[a("div",ze,[n(w,{doctype:"ECM Status",modelValue:l.status,"onUpdate:modelValue":t[19]||(t[19]=s=>l.status=s),label:e.__("Status")},null,8,["modelValue","label"])]),a("div",Ke,[n(w,{doctype:"ECM Category",modelValue:l.category,"onUpdate:modelValue":t[20]||(t[20]=s=>l.category=s),label:e.__("Category")},null,8,["modelValue","label"])])])])])])]),a("div",He,[o(_).data?(f(),T(_e,{key:0,eventName:o(_).data.name,title:l.title,allowEdit:!0},null,8,["eventName","title"])):le("",!0)])])])}}};export{Qe as default};
//# sourceMappingURL=CreateEvent-BXoUyX_g.js.map
